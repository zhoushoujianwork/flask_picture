'use strict';var up2picbed=function(){class a{constructor(a){return a.elem&&a.url?void(a.size=parseInt(a.size||10240),a.exts=a.exts||"jpg|png|gif|bmp|jpeg|webp",a.name=a.name||"picbed",a.timeout=parseInt(a.timeout||5e3),a.responseType="json",a.onSuccess="function"==typeof a.success&&a.success,a.onFail="function"==typeof a.fail&&a.fail,a.onProgress="function"==typeof a.progress&&a.progress,this.opt=a,this._init()):(this._alert("\u8BF7\u5B8C\u5584\u53C2\u6570"),!1)}_init(){let a=document.querySelector(this.opt.elem),b=this.opt.name,c=a.parentElement.querySelector(`input[name='${b}']`);c&&a.parentElement.removeChild(c),c=document.createElement("input"),c.type="file",c.name=b,c.style.display="none",c.onchange=a=>this._upload(this.opt,a),a.parentElement.appendChild(c),a.onclick=()=>{let b=a.parentElement.querySelector("input[type='file']");b.click()}}_upload(a,b){let c=this,d=a.size,e=a.exts,f=b.target.files;if(!f.length)return;const g=f[0];if(0<d){10240<d&&(d=10240);let a=g.size/1024;if(a>d)return c._alert("\u4E0A\u4F20\u56FE\u7247\u8D85\u8FC7\u9650\u5236\u5927\u5C0F\u3010"+d+"KB\u3011")}if(e){let a=new RegExp("("+e+"$)","i"),b=g.name.split(".");if(b=b[b.length-1],!a.test(b))return c._alert("\u4E0D\u652F\u6301\u7684\u56FE\u7247\u683C\u5F0F\u3010"+b+"\u3011")}let h=new FormData;if(h.append(a.name,g,g.name),"object"==typeof a.data&&0!==Object.keys(a.data).length)for(let b in a.data)h.append(b,a.data[b]);let i=new XMLHttpRequest;if(i.timeout=a.timeout,i.responseType=a.responseType,i.open("POST",a.url,!0),"object"==typeof a.headers&&0!==Object.keys(a.headers).length)for(let b in a.headers)i.setRequestHeader(b,a.headers[b]);i.upload.onprogress=function(b){var c=Math.floor;let d=c(100*(b.loaded/b.total)),e=d+"%";50>d?e=5-d%5+d+"%":50<=d&&90>d&&(e=2-d%2+d+"%"),a.onProgress&&a.onProgress(e)},i.onload=function(){let b=i.response;200<=i.status&&300>i.status||304==i.status?"object"==typeof b&&0===b.code?a.onSuccess&&a.onSuccess(b):a.onFail&&a.onFail(b):a.onFail&&a.onFail(b)};try{i.send(h)}catch(a){c._alert(a.message)}}_alert(a){let b="undefined"!=typeof layer&&"object"==typeof layer&&layer.alert;b?b(a,{title:!1,shade:.1}):"undefined"!=typeof layui&&"object"==typeof layui?layui.use("layer",function(){let b=layui.layer;b.alert(a,{title:!1,shade:.1})}):window.alert(a)}}let b=function(a){return!!document.querySelector(a)},c=function(){let a=document.currentScript?document.currentScript:document.getElementsByTagName("script")[document.getElementsByTagName("script").length-1];if(a&&a.getAttribute("src")&&-1<a.getAttribute("src").indexOf("uploader.js"))return a;else{let b=document.scripts,c=b.length-1;for(let d=c;0<d;d--)if("interactive"===b[d].readyState){a=b[d];break}return a}}(),d=d=>{if(d||(d={}),"[object Object]"!==Object.prototype.toString.call(d))return console.error("up2picbed\u914D\u7F6E\u9879\u9519\u8BEF"),!1;let e=d.url||c.dataset.url,f=d.elem||c.dataset.elem||"#up2picbed",g=d.name||c.dataset.name,h=d.token||c.dataset.token,i=d.style||c.dataset.style,j=d.album||c.dataset.album,k=d.progress||c.dataset.progress&&window[c.dataset.progress],l=d.success||c.dataset.success&&window[c.dataset.success],m=d.fail||c.dataset.fail&&window[c.dataset.fail],n={};if(!b(f))return console.error("up2picbed\u672A\u53D1\u73B0\u6709\u6548\u7684elem"),!1;if(!e)return console.error("up2picbed\u672A\u53D1\u73B0\u6709\u6548\u7684url"),!1;if("false"!==i&&!1!==i){i||(i="");let[a,b]=i.split(",");a||(a="#409eff"),b||(b="#fff"),document.querySelector(f).style=`display:inline-block;margin-right:10px;padding:9px 15px;font-size:12px;background-color:${b};color:${a};border:1px ${a} solid;border-radius:3px;cursor:pointer;user-select:none;`}return j&&(n.album=j),n.origin=`uploader.js/${"1.1.1"}`,new a({elem:f,url:e,name:g,size:d.size||c.dataset.size,exts:d.exts||c.dataset.exts,data:n,headers:{Authorization:`LinkToken ${h}`},success:"function"==typeof l?l:a=>{console.log(a)},fail:"function"==typeof m?m:a=>{console.error(a)},progress:k})};return"true"===c.dataset.auto?d():d}();